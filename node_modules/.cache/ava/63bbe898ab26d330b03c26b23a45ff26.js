'use strict';

var _promise = require('/home/ec2-user/node_modules/ava/node_modules/babel-runtime/core-js/promise.js');

var _promise2 = _interopRequireDefault(_promise);

var _index = require('/home/ec2-user/node_modules/ava/node_modules/babel-runtime/regenerator/index.js');

var _index2 = _interopRequireDefault(_index);

var _asyncToGenerator2 = require('/home/ec2-user/node_modules/ava/node_modules/babel-runtime/helpers/asyncToGenerator.js');

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

var _powerAssertRecorder = function () { function PowerAssertRecorder() { this.captured = []; } PowerAssertRecorder.prototype._capt = function _capt(value, espath) { this.captured.push({ value: value, espath: espath }); return value; }; PowerAssertRecorder.prototype._expr = function _expr(value, source) { return { powerAssertContext: { value: value, events: this.captured }, source: source }; }; return PowerAssertRecorder; }();

var _fs = require('fs');

var _fs2 = _interopRequireDefault(_fs);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _pify = require('pify');

var _pify2 = _interopRequireDefault(_pify);

var _ava = require('ava');

var _ava2 = _interopRequireDefault(_ava);

var _optimize = require('./lib/optimize');

var _optimize2 = _interopRequireDefault(_optimize);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var fsP = (0, _pify2.default)(_fs2.default);
var optP = (0, _pify2.default)(_optimize2.default);

(0, _ava2.default)('optimize a PNG', function () {
  var _ref = (0, _asyncToGenerator3.default)(_index2.default.mark(function _callee(t) {
    var _rec = new _powerAssertRecorder();

    var buf, data;
    return _index2.default.wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            _context.next = 2;
            return fsP.readFile(_path2.default.join(__dirname, "fixtures", 'fixture.png'));

          case 2:
            buf = _context.sent;
            _context.next = 5;
            return optP(buf);

          case 5:
            data = _context.sent;


            console.error(buf.length, data.length);
            t.true(_rec._expr(_rec._capt(_rec._capt(_rec._capt(data, 'arguments/0/left/object').length, 'arguments/0/left') < _rec._capt(_rec._capt(buf, 'arguments/0/right/object').length, 'arguments/0/right'), 'arguments/0'), {
              content: 't.true(data.length < buf.length)',
              filepath: 'test.js',
              line: 16,
              async: true
            }));
            // t.true(isJpg(data));
            // t.true(isProgressive.buffer(data));

          case 8:
          case 'end':
            return _context.stop();
        }
      }
    }, _callee, undefined);
  }));

  return function (_x) {
    return _ref.apply(this, arguments);
  };
}());

(0, _ava2.default)('optimize a JPG', function () {
  var _ref2 = (0, _asyncToGenerator3.default)(_index2.default.mark(function _callee2(t) {
    var _rec2 = new _powerAssertRecorder();

    var buf, data;
    return _index2.default.wrap(function _callee2$(_context2) {
      while (1) {
        switch (_context2.prev = _context2.next) {
          case 0:
            _context2.next = 2;
            return fsP.readFile(_path2.default.join(__dirname, "fixtures", 'fixture.jpg'));

          case 2:
            buf = _context2.sent;
            _context2.next = 5;
            return optP(buf);

          case 5:
            data = _context2.sent;


            console.error(buf.length, data.length);
            t.true(_rec2._expr(_rec2._capt(_rec2._capt(_rec2._capt(data, 'arguments/0/left/object').length, 'arguments/0/left') < _rec2._capt(_rec2._capt(buf, 'arguments/0/right/object').length, 'arguments/0/right'), 'arguments/0'), {
              content: 't.true(data.length < buf.length)',
              filepath: 'test.js',
              line: 26,
              async: true
            }));
            // t.true(isJpg(data));
            // t.true(isProgressive.buffer(data));

            fsP.writeFile("projpg.jpg", data);

          case 9:
          case 'end':
            return _context2.stop();
        }
      }
    }, _callee2, undefined);
  }));

  return function (_x2) {
    return _ref2.apply(this, arguments);
  };
}());

(0, _ava2.default)('foo', function (t) {
  t.pass();
});

(0, _ava2.default)('bar', function () {
  var _ref3 = (0, _asyncToGenerator3.default)(_index2.default.mark(function _callee3(t) {
    var _rec3 = new _powerAssertRecorder();

    var bar;
    return _index2.default.wrap(function _callee3$(_context3) {
      while (1) {
        switch (_context3.prev = _context3.next) {
          case 0:
            bar = _promise2.default.resolve('bar');
            _context3.t0 = t;
            _context3.t1 = _rec3;
            _context3.t2 = _rec3;
            _context3.next = 6;
            return bar;

          case 6:
            _context3.t3 = _context3.sent;
            _context3.t4 = _context3.t2._capt.call(_context3.t2, _context3.t3, 'arguments/0');
            _context3.t5 = {
              content: 't.is((await bar), \'bar\')',
              filepath: 'test.js',
              line: 40,
              async: true
            };
            _context3.t6 = _context3.t1._expr.call(_context3.t1, _context3.t4, _context3.t5);

            _context3.t0.is.call(_context3.t0, _context3.t6, 'bar');

          case 11:
          case 'end':
            return _context3.stop();
        }
      }
    }, _callee3, undefined);
  }));

  return function (_x3) {
    return _ref3.apply(this, arguments);
  };
}());
//# sourceMappingURL=node_modules/.cache/ava/63bbe898ab26d330b03c26b23a45ff26.js.map